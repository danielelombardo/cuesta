#include <behaviors.dtsi>
#include <dt-bindings/zmk/keys.h>
// #include <dt-bindings/zmk/bt.h>
#include <behaviors/anti_idle_mode.dtsi>
#include <dt-bindings/anti_idle_mode.h>

&caps_word { continue-list = <MINUS UNDERSCORE BSPC DEL LEFT RIGHT DOT COMMA SEMI SLASH>; };
&sl { release-after-ms = <1000>; };

#define xxxx &none
#define ____ &trans

#define hs(l) &hsk l l 
#define mg(l) &mtg l l 
#define LEADR LG(LS(LA(LCTRL)))

#define FUM 1
#define NUM 2
#define RST &to 0

#define ZMK_MOUSE_DEFAULT_MOVE_VAL 15000  // 600
#define ZMK_MOUSE_DEFAULT_SCRL_VAL 15000  // 10
#include <dt-bindings/zmk/pointing.h>
&mmv {
  acceleration-exponent = <1>;      // 1
  time-to-max-speed-ms = <500>;    // 40
};
&msc {
  acceleration-exponent = <1>;      // 0
  time-to-max-speed-ms = <500>;   // 500
};

/ { 
    macros {
        numshf: num_shift { compatible = "zmk,behavior-macro"; wait-ms = <0>; tap-ms = <0>; #binding-cells = <0>;
                            bindings = <&macro_press &sk LSHFT &sl NUM>, <&macro_pause_for_release>, <&macro_release &sk LSHFT &sl NUM>; };
        funmou: fun_mouse { compatible = "zmk,behavior-macro"; wait-ms = <0>; tap-ms = <1>; #binding-cells = <0>;
                            bindings = <&macro_tap &kp K_CANCEL &sl FUM>; };
        ltg: layer_tog    { compatible = "zmk,behavior-macro-one-param"; wait-ms = <0>; tap-ms = <1>; #binding-cells = <1>;
                            bindings = <&macro_tap &kp K_CANCEL>, <&macro_param_1to1>, <&macro_tap &tog MACRO_PLACEHOLDER>; };
        capwrd: capsword  { compatible = "zmk,behavior-macro"; wait-ms = <0>; tap-ms = <1>; #binding-cells = <0>;
                            bindings = <&macro_tap &kp K_CANCEL &caps_word>; };
    };

    behaviors {
        sm: stick_mod       { compatible = "zmk,behavior-sticky-key"; #binding-cells = <1>; bindings = <&kp>; release-after-ms = <2000>; quick-release; ignore-modifiers; };
        hsk: holdstickymod  { compatible = "zmk,behavior-hold-tap";   #binding-cells = <2>; flavor = "balanced"; hold-while-undecided; tapping-term-ms = <200>; bindings = <&kp>, <&sm>; }; 
        mtg: mo_tog         { compatible = "zmk,behavior-hold-tap";   #binding-cells = <2>; flavor = "balanced"; tapping-term-ms = <200>; bindings = <&mo>, <&tog>; }; 
//        symi: symtap        { compatible = "zmk,behavior-hold-tap";   #binding-cells = <2>; flavor = "balanced"; tapping-term-ms = <200>; bindings = <&numshf>, <&sl>; }; 
//        blt: bluetoot     { compatible = "zmk,behavior-mod-morph";  #binding-cells = <0>; bindings = <&bt BT_NXT>, <&bt BT_CLR>; mods = <MOD_RALT>; };
//        pars: parentheses   { compatible = "zmk,behavior-mod-morph";  #binding-cells = <0>; bindings = <&kp LPAR>, <&kp RPAR>; mods = <(MOD_LSFT|MOD_RSFT)>; };
        vold: volume_dw_mu   { compatible = "zmk,behavior-mod-morph";  #binding-cells = <0>; bindings = <&kp C_VOL_DN>, <&kp C_MUTE>; mods = <(MOD_LSFT|MOD_RSFT)>; };
        volu: volume_up_prsc { compatible = "zmk,behavior-mod-morph";  #binding-cells = <0>; bindings = <&kp C_VOL_UP>, <&kp PSCRN>; mods = <(MOD_LSFT|MOD_RSFT)>; };
        capw: cw_capsword   { compatible = "zmk,behavior-mod-morph";  #binding-cells = <0>; bindings = <&capwrd>, <&kp CAPS>; mods = <(MOD_LSFT|MOD_RSFT)>; };
    };

    anti_idle {
        compatible = "zmk,anti-idle-generic";
        interval-ms = <60000>; // How often to send actions (ms)
        bindings = <&kp LEFT &kp RIGHT>; // Actions to perform (e.g., mouse move)
        tap_ms = <200>;  // Duration of each action (ms)
        wait_ms = <200>; // Delay between actions (ms)
    };

    keymap {
        compatible = "zmk,keymap";
        abc {
            display-name = "ABC";
            bindings = <
            //  1           2           3           4           5           6           7           8           9           10          11          12 
                &kp Q       &kp W       &kp E       &kp R       &kp T       &kp Z       &volu       &kp U       &kp I       &kp O       &kp P       &kp DEL 
                &kp TAB     &kp A       &kp S       &kp D       &kp F       &kp G       &vold       &kp H       &kp J       &kp K       &kp L       &kp BSPC 
                &kp ESC     hs(LSHFT)   &kp Y       &kp X       &kp C       &kp V       &kp B       &kp N       &kp M       hs(RCTRL)   hs(RSHFT)   &kp ENTER 
                hs(LCTRL)   &capw       hs(LEADR)   hs(RALT)    hs(LGUI)    &sl NUM     &kp SPACE   mg(FUM)     &kp LEFT    &kp DOWN    &kp UP      &kp RIGHT   
            >; 
        };

        fum {
            display-name = "f->";
            bindings = <
            //  1           2           3               4               5               6            7           8           9          10       11       12 
                &kp F12     &kp F1      &kp F2          &kp F3          &kp F4          &kp F5       &kp F6      &kp F7      &kp F8     &kp F9   &kp F10  &kp F11  
                ____     &mmv MOVE_LEFT &mmv MOVE_DOWN  &mmv MOVE_UP    &mmv MOVE_RIGHT &aim AIM_OFF &aim AIM_ON &mkp MB1    &mkp MB2   &mkp MB4 &mkp MB5 ____ 
                ____        ____        ____            &msc SCRL_UP    &msc SCRL_DOWN  xxxx         xxxx        &key_repeat &mkp MB3   ____     ____     ____ 
                ____        ____        ____            ____            ____            ____         ____        ____        ____       ____     ____     ____ 
            >; 
        };

        num {
            display-name = "/12";
            bindings = <
            //  1           2           3           4           5           6           7           8           9           10          11          12 
                &kp GRAVE   &kp N1      &kp N2      &kp N3      &kp N4      &kp N5      &kp N6      &kp N7      &kp N8      &kp N9      &kp N0      ____ 
                ____        &kp LBKT    &kp RBKT    &kp MINUS   &kp EQUAL   &kp BSLH    &kp SEMI    &kp COMMA   &kp DOT     &kp SQT     &kp SLASH   ____ 
                ____        ____        hs(LCTRL)  &kp K_CANCEL &kp HOME    &kp PG_UP   &kp PG_DN   &kp END     &kp INS     ____        ____        ____ 
                ____        ____        ____        ____        ____        &ltg NUM    ____        ____        ____        ____        ____        ____ 
            >; 
        };

    }; 
};
